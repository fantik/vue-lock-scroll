'use strict';var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(exports,'__esModule',{value:!0});function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d('next',a)},function(a){d('throw',a)})}return d('next')})}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}/* safari helper */var setAsyncTimeout=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;return new Promise(function(c){setTimeout(function(){a(),c()},b)})},ScrollLock=function(){function a(b){_classCallCheck(this,a),this.gapedElements=b?b.split(', ').map(function(a){return document.querySelector(a)}):[],this.locks=[],this.documentListenerAdded=!1,this.initialClientY=-1,this.init()}return _createClass(a,null,[{key:'install',value:function e(b,c){/* define defaults options */var d=Object.assign({propName:'$scrollLock',gapedElements:null/* reassign defaults */},c);b.prototype.hasOwnProperty(d.propName)||Object.defineProperty(b.prototype,d.propName,{value:new a(d.gapedElements)})}}]),_createClass(a,[{key:'init',value:function a(){this.testPassiveEvents(),this.testIsIos()}},{key:'testPassiveEvents',value:function b(){var a=this;if(this.hasPassiveEvents=!1,'undefined'!=typeof window){var c={get passive(){a.hasPassiveEvents=!0}};window.addEventListener('testPassive',null,c),window.removeEventListener('testPassive',null,c)}}},{key:'testIsIos',value:function a(){this.isIosDevice='undefined'!=typeof window&&window.navigator&&window.navigator.platform&&/iP(ad|hone|od)/.test(window.navigator.platform)}},{key:'isTouchMoveAllowed',value:function b(a){this.locks.some(function(b){return b.options.allowTouchMove&&b.options.allowTouchMove(a)})}},{key:'preventDefault',value:function c(a){var b=a||window.event;// For the case whereby consumers adds a touchmove event listener to document.
// Recall that we do document.addEventListener('touchmove', preventDefault, { passive: false })
// in disableBodyScroll - so if we provide this opportunity to allowTouchMove, then
// the touchmove event on document will break.
    return!!this.isTouchMoveAllowed(b.target)||!!(1<b.touches.length)||(b.preventDefault&&b.preventDefault(),!1);// Do not prevent if the event has more than one touch (usually meaning this is a multi touch gesture like pinch to zoom)
  }},{key:'isTargetElementTotallyScrolled',value:function b(a){return!!a&&a.scrollHeight-a.scrollTop<=a.clientHeight}},{key:'setOverflowHidden',value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,setAsyncTimeout(function(){if(console.log(123),void 0===c.previousBodyPaddingRight){var a=!!b&&!0===b.reserveScrollBarGap,d=window.innerWidth-document.documentElement.clientWidth;a&&0<d&&(c.previousBodyPaddingRight=document.body.style.paddingRight,document.body.style.paddingRight=d+'px',c.gapedElements.forEach(function(a){a.style.paddingRight=d+'px'}))}// If previousBodyOverflowSetting is already set, don't set it again.
    void 0===c.previousBodyOverflowSetting&&(c.previousBodyOverflowSetting=document.body.style.overflow,document.body.style.overflow='hidden')});case 2:case'end':return a.stop();}},a,this)}));return function b(){return a.apply(this,arguments)}}()},{key:'restoreOverflowSetting',value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,setAsyncTimeout(function(){void 0!==b.previousBodyPaddingRight&&(document.body.style.paddingRight=b.previousBodyPaddingRight,b.gapedElements.forEach(function(a){a.style.paddingRight=b.previousBodyPaddingRight}),b.previousBodyPaddingRight=void 0),void 0!==b.previousBodyOverflowSetting&&(document.body.style.overflow=b.previousBodyOverflowSetting,b.previousBodyOverflowSetting=void 0)});case 2:case'end':return a.stop();}},a,this)}));return function b(){return a.apply(this,arguments)}}()},{key:'handleScroll',value:function d(a,b){var c=a.targetTouches[0].clientY-this.initialClientY;return!this.allowTouchMove(a.target)&&(b&&0===b.scrollTop&&0<c?this.preventDefault(a):this.isTargetElementTotallyScrolled(b)&&0>c?this.preventDefault(a):(a.stopPropagation(),!0))}},{key:'lock',value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b,c){var d,e,f=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this.isIosDevice){a.next=7;break}if(b){a.next=4;break}return console.error('"lock" unsuccessful - targetElement must be provided when calling "lock" on IOS devices.'),a.abrupt('return');case 4:b&&!this.locks.some(function(a){return a.targetElement===b})&&(d={targetElement:b,options:c||{}},this.locks=[].concat(_toConsumableArray(this.locks),[d]),b.ontouchstart=function(a){1===a.targetTouches.length&&(f.initialClientY=a.targetTouches[0].clientY)},b.ontouchmove=function(a){1===a.targetTouches.length&&f.handleScroll(a,b)},!this.documentListenerAdded&&(document.addEventListener('touchmove',this.preventDefault,this.hasPassiveEvents?{passive:!1}:void 0),this.documentListenerAdded=!0)),a.next=11;break;case 7:return a.next=9,this.setOverflowHidden(c);case 9:e={targetElement:b,options:c||{}},this.locks=[].concat(_toConsumableArray(this.locks),[e]);case 11:case'end':return a.stop();}},a,this)}));return function b(){return a.apply(this,arguments)}}()},{key:'unlockAll',value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this.isIosDevice){a.next=7;break}this.locks.forEach(function(a){a.targetElement.ontouchstart=null,a.targetElement.ontouchmove=null}),this.documentListenerAdded&&(document.removeEventListener('touchmove',this.preventDefault,this.hasPassiveEvents?{passive:!1}:void 0),this.documentListenerAdded=!1),this.locks=[],this.initialClientY=-1,a.next=10;break;case 7:return a.next=9,this.restoreOverflowSetting();case 9:this.locks=[];case 10:case'end':return a.stop();}},a,this)}));return function b(){return a.apply(this,arguments)}}()},{key:'unlock',value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this.isIosDevice){a.next=10;break}if(b){a.next=4;break}return console.error('"unlock" unsuccessful - targetElement must be provided when calling "unlock" on IOS devices.'),a.abrupt('return');case 4:b.ontouchstart=null,b.ontouchmove=null,this.locks=this.locks.filter(function(a){return a.targetElement!==b}),this.documentListenerAdded&&0===this.locks.length&&(document.removeEventListener('touchmove',this.preventDefault,this.hasPassiveEvents?{passive:!1}:void 0),this.documentListenerAdded=!1),a.next=17;break;case 10:if(1!==this.locks.length||this.locks[0].targetElement!==b){a.next=16;break}return a.next=13,this.restoreOverflowSetting();case 13:this.locks=[],a.next=17;break;case 16:this.locks=this.locks.filter(function(a){return a.targetElement!==b});case 17:case'end':return a.stop();}},a,this)}));return function b(){return a.apply(this,arguments)}}()}]),a}();exports.default=ScrollLock,module.exports=exports.default;
